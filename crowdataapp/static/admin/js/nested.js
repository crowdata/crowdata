(function(b){function h(a){formset_prop=b("#id_"+a+"-TOTAL_FORMS");return!formset_prop.length?0:parseInt(formset_prop.attr("autocomplete","off").val())}function m(a,e){var c=h(a);e?b("#id_"+a+"-TOTAL_FORMS").attr("autocomplete","off").val(parseInt(c)+1):b("#id_"+a+"-TOTAL_FORMS").attr("autocomplete","off").val(parseInt(c)-1)}function j(a){a=b("#id_"+a+"-MAX_NUM_FORMS").attr("autocomplete","off").val();return"undefined"==typeof a||""==a?"":parseInt(a)}function n(a){var e=h(a.prefix),c=a.prefix,d=b("#"+
c+"-empty"),p=h(c),f=d.clone(!0);f.removeClass(a.emptyCssClass).addClass(a.formCssClass).attr("id",c+"-"+p);f.is("tr")?f.children(":last").append('<div><a class="'+a.deleteCssClass+'" href="javascript:void(0)">'+a.deleteText+"</a></div>"):f.is("ul")||f.is("ol")?f.append('<li><a class="'+a.deleteCssClass+'" href="javascript:void(0)">'+a.deleteText+"</a></li>"):f.children(":first").append('<span><a class="'+a.deleteCssClass+'" href="javascript:void(0)">'+a.deleteText+"</a></span>");f.find("*").each(function(){var a=
RegExp("("+c+"-(\\d+|__prefix__))"),d=c+"-"+p;b(this).attr("for")&&b(this).attr("for",b(this).attr("for").replace(a,d));this.id&&(this.id=this.id.replace(a,d));this.name&&(this.name=this.name.replace(a,d))});f.insertBefore(b(d));m(c,!0);var d=a.prefix,g=b("#"+d.prefix+"-empty").parent().children("."+d.addCssClass);q(d)?g.hide():g.show();f.find("a."+a.deleteCssClass).click(function(d){d.preventDefault();d=b(this).parents("."+a.formCssClass);for(var f=d.parent();d.next().hasClass("nested-inline-row");)d.next().remove();
d.remove();m(a.prefix,!1);a.removed&&a.removed(f)});var d=a.prefix,g=e,k=d.replace(/[-][0-9][-]/g,"-0-"),r=d+"-"+g,j=b("#"+r),l=b("#"+k+"-0").nextUntil("."+k+"-not-nested").find("."+k+"-nested-inline");l.each(function(a){var d=b(this).attr("id").split("-group")[0],f=d.replace(k+"-0",r),c=b(this).clone(),g=b(this).data("django_formset"),g=b.extend({},g);g.prefix=f;var e=c.find("#"+d+"-empty").is("tr");e?(c.find(".form-row").not(".empty-form").remove(),c.find(".nested-inline-row").remove()):c.find(".inline-related").not(".empty-form").remove();
c.find("."+g.addCssClass).remove();c.attr("id",c.attr("id").replace(d,f));c.find("*").each(function(){b(this).attr("for")&&b(this).attr("for",b(this).attr("for").replace(d,f));b(this).attr("class")&&b(this).attr("class",b(this).attr("class").replace(d,f));this.id&&(this.id=this.id.replace(d,f));this.name&&(this.name=this.name.replace(d,f))});c.find("#id_"+f+"-INITIAL_FORMS").val(0);c.find("#id_"+f+"-TOTAL_FORMS").val(1);c.find(".original").empty();e?(c.find(".tabular.inline-related tbody tr."+f+"-not-nested").tabularFormset(g),
a=b('<tr class="nested-inline-row'+(a+1<l.length?" no-bottom-border":"")+'"/>').html(b('<td colspan="100%"/>').html(c)),j.after(a)):(c.find(".inline-related").stackedFormset(g),j.after(c));n(g)});d=l.length;f.is("tr")&&0<d&&f.addClass("no-bottom-border");a.added&&a.added(f);e+=1}function q(a){return!(""!==j(a.prefix)&&0>=j(a.prefix)-h(a.prefix))}b.fn.formset=function(a){var e=b.extend({},b.fn.formset.defaults,a),c=b(this);a=c.parent();h(e.prefix);c.closest(".inline-group").data("django_formset",e);
c.each(function(){b(this).not("."+e.emptyCssClass).addClass(e.formCssClass)});q(e)&&("TR"==c.attr("tagName")?(c=this.eq(-1).children().length,a.append('<tr class="'+e.addCssClass+'"><td colspan="'+c+'"><a href="javascript:void(0)">'+e.addText+"</a></tr>"),a=a.find("tr:last a")):(c.filter(":last").after('<div class="'+e.addCssClass+'"><a href="javascript:void(0)">'+e.addText+"</a></div>"),a=c.filter(":last").next().find("a")),a.click(function(a){a.preventDefault();n(e)}));return this};b.fn.formset.defaults=
{prefix:"form",addText:"add another",deleteText:"remove",addCssClass:"add-row",deleteCssClass:"delete-row",emptyCssClass:"empty-row",formCssClass:"dynamic-form",added:null,removed:null};b.fn.tabularFormset=function(a){var e=b(this),c=function(){row_number=0;b(e.selector).not(".add-row").removeClass("row1 row2").each(function(){b(this).addClass("row"+(row_number%2+1));for(next=b(this).next();next.hasClass("nested-inline-row");)next.addClass("row"+(row_number%2+1)),next=next.next();row_number+=1})};
e.formset({prefix:a.prefix,addText:a.addText,formCssClass:"dynamic-"+a.prefix,deleteCssClass:"inline-deletelink",deleteText:a.deleteText,emptyCssClass:"empty-form",removed:function(b){c(b);a.removed&&a.removed(b)},added:function(d){d.find(".prepopulated_field").each(function(){var a=b(this).find("input, select, textarea"),f=a.data("dependency_list")||[],c=[];b.each(f,function(a,b){c.push("#"+d.find(".field-"+b).find("input, select, textarea").attr("id"))});c.length&&a.prepopulate(c,a.attr("maxlength"))});
"undefined"!=typeof DateTimeShortcuts&&(b(".datetimeshortcuts").remove(),DateTimeShortcuts.init());"undefined"!=typeof SelectFilter&&(b(".selectfilter").each(function(b,d){var c=d.name.split("-");SelectFilter.init(d.id,c[c.length-1],!1,a.adminStaticPrefix)}),b(".selectfilterstacked").each(function(b,d){var c=d.name.split("-");SelectFilter.init(d.id,c[c.length-1],!0,a.adminStaticPrefix)}));c(d);a.added&&a.added(d)}});return e};b.fn.stackedFormset=function(a){var e=b(this),c=function(a){a.children(".inline-related").not(".empty-form").children("h3").find(".inline_label").each(function(a){a+=
1;b(this).html(b(this).html().replace(/(#\d+)/g,"#"+a))})};e.formset({prefix:a.prefix,addText:a.addText,formCssClass:"dynamic-"+a.prefix,deleteCssClass:"inline-deletelink",deleteText:a.deleteText,emptyCssClass:"empty-form",removed:function(b){c(b);a.removed&&a.removed(b)},added:function(d){d.find(".prepopulated_field").each(function(){var a=b(this).find("input, select, textarea"),c=a.data("dependency_list")||[],e=[];b.each(c,function(a,b){e.push("#"+d.find(".form-row .field-"+b).find("input, select, textarea").attr("id"))});
e.length&&a.prepopulate(e,a.attr("maxlength"))});"undefined"!=typeof DateTimeShortcuts&&(b(".datetimeshortcuts").remove(),DateTimeShortcuts.init());"undefined"!=typeof SelectFilter&&(b(".selectfilter").each(function(b,c){var d=c.name.split("-");SelectFilter.init(c.id,d[d.length-1],!1,a.adminStaticPrefix)}),b(".selectfilterstacked").each(function(b,c){var d=c.name.split("-");SelectFilter.init(c.id,d[d.length-1],!0,a.adminStaticPrefix)}));c(d.parent());a.added&&a.added(d)}});return e}})(django.jQuery);
